​		一个java程序的执行流程可以简单的分为以下几个步骤：1.编辑源代码--->2.编译阶段，生成.class文件，即源文件有编译器编译成字节码文件--->3.类加载器加载字节码文件--->4.虚拟机加载运行。

***

### 1、源代码阶段

> 由程序员负责    *.java 文件



### 2、编译阶段

> Java  Complier （java编译器）     *.class 文件（字节码文件）
>
> *.Class文件是一组以8字节为基础单位的二进制流

​		java编译一个类时，如果这个类所依赖的类还没有被编译，编译器会自动的先编译这个所依赖的类，然后引用。如果java编译器在指定的目录下找不到该类所依赖的类的 .class文件或者 .java源文件，就会报"Cant found sysbol"的异常错误。

编译后的字节码文件格式主要分为两部分：

* 常量池和方法字节码。常量池记录的是代码出现过的（常量、类名、成员变量等）以及符号引用（类引用、方法引用，成员变量引用等）；
* 方法字节码中放的是各个方法的字节码。



### 3、加载阶段	

> 虚拟机的类加载机制：虚拟机把描述类的数据从class文件加载到内存，并对数据进行效验，转换解析和初始化，最终形成可以被虚拟机直接使用的java类型
>
> 注意：java的加载只有在使用一个类时才会加载，并且只加载一次



### 4、运行

> 运行分两步：
>
> （1）类的加载 
>
> （2）类的执行。

（1）在类路径下找到编译好的 java 程序中得到 Test.class 字节码文件后，在命令行上敲 java Test，系统就会启动一个  JVM  进程，JVM进程从classpath路径下找到一个名为Test.class的二进制文件，将Test.class文件中的类信息加载到运行时数据区的方法区中，这一过程叫做类的加载。（只有类信息在方法区中，才能创建对象，使用类中的成员变量）；

（2）JVM 找到main方法的主函数入口， 持有一个指向当前类(Test)常量池的指针，而常量池中的第一项是发现是一个对Animal对象的符号引用，并且main方法中第一条指令是 Animal animal = new Animal("super_yc")，就是让JVM创建一个Animal对象，但是方法区中还没有Animal类的类信息，于是JVM就要马上的加载Animal类，将Animal类信息放入到方法区中，于是JVM以一个直接指向方法区Animal类的指针替换了常量池中第一项的符号引用；

（3）加载完Animal类的信息以后，JVM虚拟机就会在堆内存中为一个Animal类实例分配内存，然后调用其本身的构造函数初始化Animal实例，这个实例持有指向方法区的Animal类的类型信息（其中包含有方发表，java动态绑定的底层实现）的引用。（animal指向了Animal对象的引用会自动的放在栈中，字符串常量"super_yc"会自动的放在方法区的常量池中，对象会自动的放入堆区）

（4）当使用 animal.pringName()的时候，JVM根据栈中animal引用找到Animal对象，然后根据Animal对象持有的引用定位到方法区中Animal类的类型信息方法表，获得pringName()函数的字节码地址，然后开始运行函数。



![img](https://images2018.cnblogs.com/blog/1399558/201807/1399558-20180703143638680-2007449200.png)





补充：java中的常量池

java中的常量池分为两种形态，静态常量池，运行时常量池

> 静态常量池： *.class文件中的常量池
>
> 运行时常量池：jvm在完成类装载操作后，将 .class 文件中的常量池载入内存中，并保存于方法区，此即运行时常量池。